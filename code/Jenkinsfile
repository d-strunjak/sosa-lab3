pipeline {
    agent any
    stages {
        stage('stage 1') {
            steps {
                echo 'Hello world!'
                bat 'python --version'
            }
        }
        stage('Test') {
            steps {
                script {
                    set 'TIMESTAMP=%DATE:~10,4%%DATE:~4,2%%DATE:~7,2%_%TIME:~0,2%%TIME:~3,2%%TIME:~6,2%%TIME:~9,2%'
                    echo '%TIMESTAMP%'
                    try {
                        bat 'python test\\code\\unit_test_A.py'
                    } catch (Exception e) {
                        echo 'Exception occurred: ' + e.toString()
                        bat 'python test\\code\\unit_test_A.py 2> "logs\\unit_test_%TIMESTAMP%.txt"'
                    }
                    try {
                        bat 'bandit -r test\\code\\dodatak_A.py'
                    } catch (Exception e) {
                        echo 'Exception occurred: ' + e.toString()
                        bat 'bandit -r test\\code\\dodatak_A.py -f json -o "logs\\bandit_test_%TIMESTAMP%.json"'
                    } 
                }
            }
        }
        // stage('Clear') {
        //     steps {
        //         bat 'rmdir /s /q test'
        //     }
        // }
        
    }
}