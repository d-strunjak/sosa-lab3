pipeline {
    agent any
    stages {
        stage('Test') {
            steps {
                script {
                    try {
                        bat 'python test\\code\\unit_test_A.py 2> "logs\\unit_test_%DATE:~10,4%%DATE:~4,2%%DATE:~7,2%_%TIME:~0,2%%TIME:~3,2%%TIME:~6,2%%TIME:~9,2%.txt"'
                    } catch (Exception e) {
                        echo 'TEST FAILED! Check logs for more info'
                        echo 'Exception occurred: ' + e.toString()
                        // throw e
                    }
                }
            }
        }
        stage('Security Test') {
            steps {
                script {
                    try {
                        bat 'bandit -r test\\code\\dodatak_A.py -f json -o "logs\\bandit_test_%DATE:~10,4%%DATE:~4,2%%DATE:~7,2%_%TIME:~0,2%%TIME:~3,2%%TIME:~6,2%%TIME:~9,2%.json"'
                        
                    } catch (Exception e) {
                        echo 'SECURITY TEST FAILED! Check logs for more info'
                        echo 'Exception occurred: ' + e.toString()
                        // throw e
                        
                    }
                }
            }
        }
        stage('Deliver') {
            steps {
                bat 'xcopy /s /e /v /Q test\\ production\\'
            }
        }
        stage('Clear') {
            steps {
                bat 'rmdir /s /q test'
            }
        }
        
    }
}